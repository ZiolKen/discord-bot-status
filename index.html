<!DOCTYPE html>
<html lang="en">

<head>
  <meta charSet="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta content="ie=edge" http-equiv="X-UA-Compatible" />
  <link rel="icon" type="image/png" href="assets/ico.png" />
  <title>ZiolKen | Bot Status</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preload" href="https://challenges.cloudflare.com/turnstile/v0/api.js" as="script" />
  <meta name="theme-color" content="#000000" />
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" /> -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-cpp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-java.min.js"></script>
  <link rel="manifest" href="assets/manifest.json" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/ico.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/ico.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/ico.png" />
  <meta name="description" content="@ã‚¸ã‚ªãƒ«ã‚±ãƒ³ | Discord bot status, current system info & status, real-time update. â€¢ @ZiolKen." />
  <meta name="author" content="@ã‚¸ã‚ªãƒ«ã‚±ãƒ³ | Bot Status" />
  <meta property="og:title" content="@ã‚¸ã‚ªãƒ«ã‚±ãƒ³ | Bot Status" />
  <meta property="og:description" content="@ã‚¸ã‚ªãƒ«ã‚±ãƒ³ | Discord bot status, current system info & status, real-time update. â€¢ @ZiolKen." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="@ã‚¸ã‚ªãƒ«ã‚±ãƒ³ | Bot Status" />
  <meta name="twitter:description" content="@ã‚¸ã‚ªãƒ«ã‚±ãƒ³ | Discord bot status, current system info & status, real-time update. â€¢ @ZiolKen." />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
<header class="container">
  <div class="Header">
      <img src="https://files.catbox.moe/as98bi.png" alt="BOTSTATUS">
      <button class="ibtn"><a href="https://discord.com/oauth2/authorize?client_id=1398238289500307578&scope=bot&permissions=8" target="_blank"><img src="./assets/discord.png"></a></button>
  </div>

  <div id="global-status" class="status-banner loading">
    <span class="pulse"></span>
    <span id="global-text">Checking system statusâ€¦</span>
  </div>
</header>

<main class="container">

  <!-- SUMMARY -->
  <section class="summary">
    <div class="card"><span>Ping</span><strong id="ping">--</strong></div>
    <div class="card"><span>Uptime</span><strong id="uptime">--</strong></div>
    <div class="card"><span>Servers</span><strong id="guilds">--</strong></div>
    <div class="card"><span>Users</span><strong id="users">--</strong></div>
  </section>

  <!-- SERVICES -->
  <section class="card">
    <h2>Services</h2>
    <div id="service-host" class="service-card"></div>
    <div id="service-gateway" class="service-card"></div>
    <div id="service-api" class="service-card"></div>
    <div id="service-commands" class="service-card"></div>
  </section>

  <!-- INCIDENTS -->
  <section class="card">
    <h2>Incidents</h2>
    <div id="incidents">Loadingâ€¦</div>
  </section>

  <!-- CHART -->
  <section class="card">
    <h2>Ping History</h2>
    <canvas id="pingChart" height="90"></canvas>
  </section>

  <!-- TECH -->
  <section class="card tech">
    <h2>Technical Information</h2>
    <div class="tech-grid">
      <div><span>Last update</span><b id="updated">--</b></div>
      <div><span>Last boot</span><b id="boot">--</b></div>
      <div><span>Average ping</span><b id="ping-tech">--</b></div>
      <div><span>Bot Ver</span><b>1.2.7</b></div>
      <div><span>Node.js</span><b>22.16.0</b></div>
      <div><span>discord.js</span><b>14.13.0</b></div>
    </div>
  </section>

</main>

<footer>
  Â© 2025 ZiolKen â€¢ Status Page
</footer>

<script>
const STATUS_URL = "https://discord-bot-us.onrender.com/status";
const INCIDENTS_URL = "https://discord-bot-us.onrender.com/incidents";

/* ===== CHART ===== */
const pingHistory = [];
const MAX = 30;

const chart = new Chart(
  document.getElementById("pingChart"), {
    type:"line",
    data:{ labels:[], datasets:[{ data:[], borderWidth:2, tension:.4 }]},
    options:{ plugins:{ legend:{display:false}}, scales:{ x:{display:false}}}
  }
);

function chartPush(p) {
  if (pingHistory.length >= MAX) pingHistory.shift();
  pingHistory.push(p);
  chart.data.labels = pingHistory.map((_,i)=>i);
  chart.data.datasets[0].data = pingHistory;
  chart.update();
}

/* ===== UPTIME ===== */
const stats = {
  host:{up:0,down:0},
  gateway:{up:0,down:0},
  api:{up:0,down:0},
  commands:{up:0,down:0}
};

const uptime = s => {
  const t=s.up+s.down;
  return t===0?"100%":((s.up/t)*100).toFixed(2)+"%";
};

/* ===== RENDER ===== */
function renderService(id, name, state) {
  state==="online"?stats[id].up++:stats[id].down++;

  document.getElementById(`service-${id}`).innerHTML = `
    <div>
      <div class="service-name">${name}</div>
      <div class="service-meta">Uptime: ${uptime(stats[id])}</div>
    </div>
    <div class="service-status ${state}">
      ${state==="online"?"â€¢ Operational":"â€¢ Down"}
    </div>`;
}

function renderGlobal(status, incidents) {
  const box = document.getElementById("global-status");
  const text = document.getElementById("global-text");

  let cls="ok", msg="All Systems Operational";

  if (status.hostService === "down") {
    cls="down"; msg="Major System Outage";
  } else if (incidents.some(i=>!i.resolvedAt)) {
    cls="degraded"; msg="Partial System Outage";
  }

  box.className = `status-banner ${cls}`;
  text.textContent = msg;
}

function renderIncidents(list) {
  const el = document.getElementById("incidents");
  if (!list.length) {
    el.textContent = "No incidents ðŸŽ‰";
    return;
  }
  el.innerHTML = "";
  list.forEach(i=>{
    el.innerHTML+=`
      <div class="incident ${i.resolvedAt?"resolved":"active"}">
        <strong>${i.title}</strong><br>
        ${i.service} â€¢ ${i.resolvedAt?"Resolved":"Investigating"}
      </div>`;
  });
}

/* ===== LOAD ===== */
async function load() {
  try {
    const [s,i] = await Promise.all([
      fetch(STATUS_URL).then(r=>r.json()),
      fetch(INCIDENTS_URL).then(r=>r.json())
    ]);

    document.getElementById("ping").textContent = `${Math.round(s.ping)} ms`;
    document.getElementById("ping-tech").textContent = `${Math.round(s.ping)} ms`;
    document.getElementById("uptime").textContent = s.uptime;
    document.getElementById("guilds").textContent = s.guilds;
    document.getElementById("users").textContent = s.users;

    document.getElementById("updated").textContent =
      new Date(s.updated).toLocaleString();
    document.getElementById("boot").textContent =
      new Date(s.lastBoot).toLocaleString();
      
    const hostState =
      s.hostService === "operational" ? "online" : "down";
    
    renderService("host", "Host System", hostState);
    renderService("gateway","Discord Gateway",s.services.gateway);
    renderService("api","API Endpoint",s.services.api);
    renderService("commands","Command System",s.services.commands);

    renderIncidents(i);
    renderGlobal(s,i);
    chartPush(s.ping);

  } catch {
    const box=document.getElementById("global-status");
    box.className="status-banner down";
    document.getElementById("global-text").textContent =
      "Status service unreachable";
  }
}

load();
setInterval(load,1000);
</script>

</body>

</html>